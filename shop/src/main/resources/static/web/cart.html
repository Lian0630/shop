<!DOCTYPE html>
<html>

	<head>

		<meta charset="utf-8" />
		<title>連的交易所</title>
		<!--核心文件-->
		<script src="../js/jquery-1.9.1.min.js"></script>
		<script src="../js/cart.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/rightBox.js" type="text/javascript"></script>
		<link rel="stylesheet" href="../css/projectAll.css">	
		<script src="../js/header.js" type="text/javascript"></script>
		<script src="../js/footer.js" type="text/javascript"></script>
		<link rel="stylesheet" href="../css/header.css">
		<link rel="stylesheet" href="../css/footer.css">
		
		
		<style type="text/css">
			.login-title{display: none;}
		
			
			
			.cart-table th {
				text-align: center;
			}
			.cart-table {
				text-align: center;
			}
			
			
			.article{ background-image:url(../images/index/bg6.jpg); width:1500px; height:600px;overflow: hidden;margin:0 auto;}
			.panel-primary{background-color: rgba(255,255,255,0.55);}
			.panel-title{padding-top: 10px;text-align: center;font-size:200%}	
			.panel-body{padding-top: 30px;}	
					
			
				
				
				
		
		</style>
		
		
	</head>

	<body>
		<!-- 右側懸浮 -->
		<div class="right_box">
			
		</div>
		<!-- 右側懸浮結束 -->
		
		<!--頭部開始-->
		<header class="header">
			<!--logo-->
			<div>
				<a href="index.html">
					<img src="../images/index/logo.png" />
				</a>
			</div>
			

		</header>
		<!--頭部结束-->
		


		<div class="article">

			<div class="panel-primary">
				<div class="panel-heading">
					<h3 class="panel-title">購物車</h3>
				</div>
				<div class="panel-body">
					<form role="form" method="get" action="orderConfirm.html">
						<!--購物車表格開始-->
						<table class="cart-table" width="100%">
							<thead>
								<tr>
									<th width=""><input type="checkbox" class="ckall" onclick="checkall(this)" />全選</th>
									<th width=""></th>
									<th width="">商品</th>
									<th width="">單價</th>
									<th width="">數量</th>
									<th width="">金額</th>
									<th width="">操作</th>
								</tr>
							</thead>
							<tbody id="cart-list" class="cart-body">
								<tr>
									<td>
										<input type="checkbox" class="ckitem" />
									</td>
									<td><img src="../images/portal/12DELLXPS13-silvery/collect.png" width="0" /></td>
									<td>比特幣</td>
									<td>$<span id="goodsPrice1">5298</span></td>
									<td>
										<input type="button" value="-" class="num-btn" onclick="reduceNum(1)" />
										<input id="goodsCount1" type="text" size="2" readonly="readonly" class="num-text" value="1">
										<input class="num-btn" type="button" value="+" onclick="addNum(1)" />
									</td>
									<td><input type="button" onclick="delCartItem(this)" class="cart-del btn btn-default btn-xs" value="删除"/></td>
								</tr>
								
							</tbody>
						</table>
						<div class="total-bar">
							<a href="javascript:selDelCart()" class="cart-del-sel btn btn-default btn-xs">刪除所選商品</a>
							<span class="pull-right">
								<span id="selectCount"></span>
							<span id="selectTotal"></span>

							</span>

						</div>
						<div>
							<span class="pull-right">
								<input type="submit" value="  結  算  " class="btn btn-primary btn-lg link-account" />
							</span>
						</div>

					</form>
				</div>
			</div>

		</div>
		
	
		
		<!--尾部-->
		<footer class="footer">
			<!-- 安全保護 銀行匯款 客戶服務 -->
			<div class="foot">			
				<span class="foot-left">
					<a href="customerService.html">
						<img src="../images/index/reg1.jpg" width="20%" height="20%">
					</a>
					安全保護
				</span>
				<span class="foot-mid">
					<a href="customerService.html">
						<img src="../images/index/reg2.jpg" width="20%" height="20%">
					</a>	
					銀行匯款
				</span>			
				<span class="foot-right">
					<a href="customerService.html">
						<img src="../images/index/reg3.jpg" width="20%" height="20%">
					</a>
					客戶服務
				</span>
			</div>
			<!--公告 常見問題 聯繫我們-->
			<div class="bottom" >

				<div class="bottom-mid" >
					<div>
						<ul>
							<li><h5>公告</h5></li>
							<li><a href="customerAnnouncement.html" style="color:white;text-decoration:none;">新手指南</a></li>
							<li><a href="customerAnnouncement.html" style="color:white;text-decoration:none;">服務保障</a></li>
							<li><a href="customerAnnouncement.html" style="color:white;text-decoration:none;">常見問題</a></li>
						</ul>
					</div>
					<div>
						<ul>
							<li><h5>常見問題</h5></li>
							<li><a href="customerProblem.html" style="color:white;text-decoration:none;">個人戶實名驗證審核流程</a></li>
							<li><a href="customerProblem.html" style="color:white;text-decoration:none;">有哪些現行支付方法可以購買數位資產？</a></li>
							<li><a href="customerProblem.html" style="color:white;text-decoration:none;">如何購買數位資產？</a></li>
						</ul>
					</div>
					<div>
						<ul>
							<li><h5>聯繫我們</h5></li>
							<li>線上客服：週一至週五(例假日除外)上午十點至下午六點</li>
							<li>電話:(02)2722-xxxx</li>
							<li>信箱：sky79316@gmail.com</li>
							<li>門市地址：台北市中正區八德路X段 XXX 號</li>
						</ul>
					</div>
				</div>
			</div>
			<!-- 頁面最下 -->
			<div class="bottom-down" align="center">
				<i>關於LianExchanges&nbsp/&nbsp使用條款&nbsp/&nbsp隱私權政策&nbsp/&nbsp常見問題</i>
			</div>

		</footer>
		<!--頁面结束-->
		<script type="text/javascript">
			$(function() {
				//返回連接
				$(".link-account").click(function() {
					location.href = "orderConfirm.html";
				})
			})
		</script>
	
	<script type="text/javascript">
	$(document).ready(function(){
		showCartList();
	});
	
	function showCartList(){
		$.ajax({
			"url":"../cart/list",
			"type":"GET",
			"dataType":"json",
			"success":function(json){
				var list = json.data;
				console.log("data.length="+list.length);
				
				$("#cart-list").empty();
				
				for(var i=0;i<list.length;i++){
					var html = '<tr>'
						+'<td>'
						+'<input type="checkbox" name="cart_id" value="#{id}" class="ckitem" />'
						+'</td>'
						+'<td><img src="..#{image}2.jpg" width="100"/></td>'
						+'<td>#{title}</td>'
						+'<td>$<span id="moneyPrice#{id}">#{price}</span></td>'
						+'<td>'
						+'<input type="button" value="-" class="num-btn" onclick="reduceCount(#{id})" />'
						+'<input id="moneyCount#{id}" type="text" size="2" readonly="readonly" class="num-text" value="#{count}">'
						+'<input class="num-btn" type="button" value="+" onclick="addCount(#{id})" />'
						+'</td>'
						+'<td>$<span id="moneyTotalPrice#{id}">#{total_price}</span></td>'
						+'<td><input type="button" onclick="deleteById(#{id})" value="删除"/></td>'
						+'</tr>';
					
					html = html.replace(/#{id}/g, list[i].id);
					html = html.replace(/#{image}/g, list[i].image);
					html = html.replace(/#{title}/g, list[i].title);
					html = html.replace(/#{price}/g, list[i].newPrice);
					html = html.replace(/#{count}/g, list[i].count);
					html = html.replace(/#{total_price}/g, list[i].newPrice * list[i].count);
					
					$("#cart-list").append(html);
				}
			}
		});
	}
	
	function addCount(id){
		var url = "../cart/add_count";
		var data = "id="+id;
		$.ajax({
			"url":url,
			"data":data,
			"type":"GET",
			"dataType":"json",
			"success":function(json){
			
				var c = parseInt($("#moneyCount"+id).val());
				c++;
				$("#moneyCount"+id).val(c);
				
				var p = parseInt($("#moneyPrice"+id).html());
				var tp = p * c;
				$("#moneyTotalPrice"+id).html(tp);
			},
			"error":function(){
				alert("您的登入時間已過期!請重新登入!");
				location.href = "login.html";
			}
		});
	}
	
	function reduceCount(id){
		var url = "../cart/reduce_count";
		var data = "id="+id;
		$.ajax({
			"url":url,
			"data":data,
			"type":"GET",
			"dataType":"json",
			"success":function(json){
			
				var c = parseInt($("#moneyCount"+id).val());
				if(c>1){
					c--;
				}
				$("#moneyCount"+id).val(c);
				
				var p = parseInt($("#moneyPrice"+id).html());
				var tp = p * c;
				$("#moneyTotalPrice"+id).html(tp);
			},
			"error":function(){
				alert("您的登入時間已過期!請重新登入!");
				location.href = "login.html";
			}
		});
	}
	
	function deleteById(id){
		var url = "../cart/delete/" + id;
		$.ajax({
			"url":url,
			"type":"GET",
			"dataType":"json",
			"success":function(json){
				if(json.state == 200){
					//成功
					showCartList();
				}else{
					//失敗
					alert(json.message);
				}
			},
			"error":function(){
				alert("您的登入信息已過期！請重新登入！");
				location.href = "login.html";
			}
		});
	}
	</script>
		
	</body>

</html>